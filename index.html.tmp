<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conecta Portas - Sistema de Desenho</title>
  <!-- Favicon inline para evitar 404 -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üö™</text></svg>">
  <!-- Bootstrap 5 CSS (apenas para o sidebar) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Fontes e estilos da aplica√ß√£o original -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/bootstrap-sidebar.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <!-- Tema moderno - Vale do Sil√≠cio -->
  <link rel="stylesheet" href="css/modern-theme.css">
  <!-- HTML2PDF para exporta√ß√£o em PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- Compatibilidade com navegadores mais antigos -->
  <script>
    // Verificar se o navegador suporta m√≥dulos ES
    var suportaModulos = 'noModule' in HTMLScriptElement.prototype;
  </script>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <div class="logo-container">
        <img src="LOGO 2.png" alt="Logo Conecta" class="logo" id="logoImage">
      </div>
      <span id="parceiro-nome">Conecta Solu√ß√µes</span>
    </div>
  </header>

  <!-- Container principal -->
  <div id="container">
    <!-- SIDEBAR: PAINEL DE CONTROLE com Bootstrap 5 -->
    <div class="sidebar-bootstrap">
      <div class="sidebar-header">
        <h2 class="sidebar-title">Configura√ß√£o da Porta</h2>
      </div>
      
      <!-- Accordion do Bootstrap para se√ß√µes expans√≠veis -->
      <div class="accordion accordion-flush" id="configAccordion">
        
        <!-- Se√ß√£o: Informa√ß√µes B√°sicas -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingInfos">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInfos" aria-expanded="false" aria-controls="collapseInfos">
              <i class="bi bi-info-circle section-icon"></i>Informa√ß√µes B√°sicas
            </button>
          </h2>
          <div id="collapseInfos" class="accordion-collapse collapse" aria-labelledby="headingInfos" data-bs-parent="#configAccordion">
            <div class="accordion-body">
              <div class="mb-3">
                <label for="clienteInput" class="form-label">Cliente</label>
                <input type="text" class="form-control" id="clienteInput" maxlength="30" required />
              </div>
              <div class="mb-3">
                <label for="ambienteInput" class="form-label">Ambiente</label>
                <input type="text" class="form-control" id="ambienteInput" maxlength="30" required />
              </div>
              <div class="mb-3">
                <label for="larguraInput" class="form-label">Largura (mm)</label>
                <input type="number" class="form-control" id="larguraInput" value="700" min="200" max="1500" required />
                <div class="invalid-feedback" id="larguraError">Largura deve ser entre 200 e 1500 mm</div>
              </div>
              <div class="mb-3">
                <label for="alturaInput" class="form-label">Altura (mm)</label>
                <input type="number" class="form-control" id="alturaInput" value="2100" min="200" max="3000" required 
                       onchange="if(this.value >= 200 && this.value <= 3000) { 
                         const altura = parseInt(this.value);
                         if (typeof window.definirNumeroDobradicas === 'function') {
                           window.definirNumeroDobradicas(altura);
                         }
                       }" />
                <div class="invalid-feedback" id="alturaError">Altura deve ser entre 200 e 3000 mm</div>
              </div>
              <div class="mb-3">
                <label for="quantidadeInput" class="form-label">Quantidade</label>
                <input type="number" class="form-control" id="quantidadeInput" value="1" min="1" max="100" required />
                <div class="invalid-feedback" id="quantidadeError">Quantidade deve ser entre 1 e 100</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Se√ß√£o: Fun√ß√£o -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFuncao">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFuncao" aria-expanded="false" aria-controls="collapseFuncao" data-force-update="true">
              <i class="bi bi-door-open section-icon"></i>Fun√ß√£o da Porta
            </button>
          </h2>
          <div id="collapseFuncao" class="accordion-collapse collapse" aria-labelledby="headingFuncao" data-bs-parent="#configAccordion">
            <div class="accordion-body">
              <div class="mb-3">
                <label for="funcaoPorta" class="form-label">Tipo de Porta</label>
                <select id="funcaoPorta" class="form-select">
                  <option value="superiorDireita">Abrir Superior Direita</option>
                  <option value="superiorEsquerda">Abrir Superior Esquerda</option>
                  <option value="inferiorDireita">Abrir Inferior Direita</option>
                  <option value="inferiorEsquerda">Abrir Inferior Esquerda</option>
                  <option value="deslizante">Deslizante</option>
                </select>
              </div>

              <!-- Se√ß√£o espec√≠fica para porta de abrir (dobradi√ßas) -->
              <div id="sectionDobradicas">
                <div class="mb-3">
                  <label for="numDobradicasInput" class="form-label">N√∫mero de Dobradi√ßas</label>
                  <select id="numDobradicasInput" class="form-select">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4" selected>4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
                
                <div id="dobradicasCampos" class="mt-3">
                  <!-- Os campos de dobradi√ßas ser√£o gerados dinamicamente -->
                </div>
              </div>

              <!-- Se√ß√£o espec√≠fica para porta deslizante -->
              <div id="sectionDeslizante" style="display: none;">
                <div class="mb-3">
                  <label for="modeloDeslizante" class="form-label">Modelo do Sistema Deslizante</label>
                  <select id="modeloDeslizante" class="form-select">
                    <option value="RO-654025">RO-654025</option>
                    <option value="RO-654030">RO-654030</option>
                    <option value="KIT-4545">KIT-4545</option>
                    <option value="KIT-6060">KIT-6060</option>
                  </select>
                </div>
                
                <div class="mb-3">
                  <label for="trilhoDeslizante" class="form-label">Tipo de Trilho</label>
                  <select id="trilhoDeslizante" class="form-select">
                    <option value="Embutir">Embutir</option>
                    <option value="Sobrepor">Sobrepor</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Se√ß√£o: Puxador -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingPuxador">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePuxador" aria-expanded="false" aria-controls="collapsePuxador">
              <i class="bi bi-grip-vertical section-icon"></i>Puxador
            </button>
          </h2>
          <div id="collapsePuxador" class="accordion-collapse collapse" aria-labelledby="headingPuxador" data-bs-parent="#configAccordion">
            <div class="accordion-body">
              <div class="mb-3">
                <label for="puxadorModelo" class="form-label">Modelo</label>
                <select id="puxadorModelo" class="form-select">
                  <option value="S/Puxador">S/Puxador</option>
                  <option value="Cielo" selected>Cielo</option>
                  <option value="Luna">Luna</option>
                  <option value="Slim">Slim</option>
                  <option value="8015">8015</option>
                  <option value="Arezzo">Arezzo</option>
                </select>
              </div>
              <div class="mb-3" id="puxadorPosicaoDiv">
                <label for="puxadorPosicao" class="form-label">Posi√ß√£o</label>
                <select id="puxadorPosicao" class="form-select">
                  <option value="vertical" selected>Vertical</option>
                  <option value="horizontal">Horizontal</option>
                </select>
              </div>
              
              <div class="mb-3" id="puxadorLadosDiv" style="display: none;">
                <label for="puxadorLados" class="form-label">Lados</label>
                <select id="puxadorLados" class="form-select">
                  <option value="esquerdo">Esquerdo</option>
                  <option value="direito">Direito</option>
                  <option value="ambos">2 Lados</option>
                </select>
              </div>
              
              <div class="mb-3">
                <label for="puxadorMedida" class="form-label">Medida</label>
                <select id="puxadorMedida" class="form-select">
                  <option value="100">100 mm</option>
                  <option value="150" selected>150 mm</option>
                  <option value="200">200 mm</option>
                  <option value="300">300 mm</option>
                  <option value="400">400 mm</option>
                  <option value="500">500 mm</option>
                  <option value="600">600 mm</option>
                  <option value="700">700 mm</option>
                  <option value="800">800 mm</option>
                  <option value="900">900 mm</option>
                  <option value="1000">1000 mm</option>
                </select>
              </div>
              
              <!-- Campos de cotas do puxador -->
              <div id="puxadorCotasCampos" class="mt-3">
                <!-- Campos para puxador vertical -->
                <div id="cotasVertical">
                  <div class="cota-field mb-2">
                    <div class="cota-label">Cota Sup:</div>
                    <div class="flex-grow-1"></div>
                    <input type="number" id="puxadorCotaSuperior" class="cota-input" min="0" max="3000" value="950" />
                  </div>
                  
                  <div class="cota-field">
                    <div class="cota-label">Cota Inf:</div>
                    <div class="flex-grow-1"></div>
                    <input type="number" id="puxadorCotaInferior" class="cota-input" min="0" max="3000" value="1000" />
                  </div>
                </div>
                
                <!-- Campo para puxador horizontal -->
                <div id="cotasHorizontal" style="display: none;">
                  <div class="cota-field">
                    <div class="cota-label">Dist. Lateral:</div>
                    <div class="flex-grow-1"></div>
                    <input type="number" id="puxadorDeslocamento" class="cota-input" min="0" max="3000" value="100" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Se√ß√£o: Materiais -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingMateriais">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMateriais" aria-expanded="false" aria-controls="collapseMateriais">
              <i class="bi bi-tools section-icon"></i>Materiais
            </button>
          </h2>
          <div id="collapseMateriais" class="accordion-collapse collapse" aria-labelledby="headingMateriais" data-bs-parent="#configAccordion">
            <div class="accordion-body">
              <div class="mb-3">
                <label for="vidroTipo" class="form-label">Vidro</label>
                <select id="vidroTipo" class="form-select">
                  <option value="Incolor">Incolor</option>
                  <option value="Espelho">Espelho</option>
                  <option value="Espelho Bronze">Espelho Bronze</option>
                  <option value="Espelho Fum√™">Espelho Fum√™</option>
                  <option value="Refleta Bronze">Refleta Bronze</option>
                  <option value="Refleta Fume">Refleta Fume</option>
                  <option value="Refleta Prata">Refleta Prata</option>
                  <option value="Fum√™">Fum√™</option>
                  <option value="Branco">Branco</option>
                  <option value="Super Branco">Super Branco</option>
                  <option value="Preto">Preto</option>
                  <option value="Canelado">Canelado</option>
                  <option value="Acidato">Acidato</option>
                  <option value="Acidato Fume">Acidato Fume</option>
                  <option value="Mini Boreal">Mini Boreal</option>
                  <option value="Colorido">Colorido (Obs)</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="perfilModelo" class="form-label">Modelo do Perfil</label>
                <select id="perfilModelo" class="form-select">
                  <option value="RM-114">RM-114</option>
                  <option value="RM-115">RM-115</option>
                  <option value="RM-117">RM-117</option>
                  <option value="RM-120">RM-120</option>
                  <option value="RM-121">RM-121</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="perfilCor" class="form-label">Cor do Perfil</label>
                <select id="perfilCor" class="form-select">
                  <option value="Anodizado">Anodizado</option>
                  <option value="Branco">Branco</option>
                  <option value="Preto">Preto</option>
                  <option value="Bronze">Bronze</option>
                  <option value="Champagne">Champagne</option>
                  <option value="Dourado">Dourado</option>
                  <option value="Inox">Inox</option>
                  <option value="Colorido/Especial">Colorido/Especial</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Se√ß√£o: Observa√ß√µes (Bot√£o para abrir modal) -->
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingObs">
            <button class="accordion-button collapsed modal-trigger" type="button" data-bs-toggle="modal" data-bs-target="#observacoesModal" id="btnAbrirObservacoes">
              <i class="bi bi-pencil-square section-icon"></i>OBSERVA√á√ïES
            </button>
          </h2>
        </div>
      </div>

      <!-- Bot√µes de a√ß√£o do sidebar -->
      <div class="sidebar-actions">
        <button id="btnImprimir" class="btn btn-primary">
          <i class="bi bi-printer"></i>
          <span>Imprimir</span>
        </button>
        
        <button id="btnSalvarRapido" class="btn btn-primary">
          <i class="bi bi-save"></i>
          <span>Salvar</span>
        </button>
        
        <button id="btnCarregarProjetos" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#projetosModal">
          <i class="bi bi-folder-fill"></i>
          <span>Projetos</span>
        </button>
      </div>
    </div>

    <!-- √Årea do desenho -->
    <div class="canvas-container">
      <div class="design-container">
        <div id="desenho" style="position: relative; z-index: 20; background-color: white;"></div>
        <div class="specs-table-container" id="specs-container" style="position: relative; z-index: 10; margin-top: 15px; background-color: white;">
          <!-- A tabela de especifica√ß√µes ser√° renderizada aqui -->
        </div>
      </div>
    </div>

    <!-- √Årea do desenho (SIMPLIFICADA) -->
    <div class="canvas-container">
      <div id="desenho" style="position: relative; z-index: 20; background-color: white; margin-bottom: 20px;"></div>
      <div class="specs-table-container" id="specs-container" style="position: relative; z-index: 10; margin-top: 15px; background-color: white;">
        <!-- A tabela de especifica√ß√µes ser√° renderizada aqui -->
      </div>
    </div>

    <!-- √Årea do desenho (CORRIGIDA) -->
    <div class="canvas-container">
      <div id="desenho" style="position: relative; z-index: 30; background-color: white; margin-bottom: 20px;"></div>
      <div class="specs-table-container" id="specs-container" style="position: relative; z-index: 10; margin-top: 20px; background-color: white;">
        <!-- A tabela de especifica√ß√µes ser√° renderizada aqui -->
      </div>
    </div>

    <!-- √Årea do desenho (CORRIGIDA) -->
    <div class="canvas-container">
      <div id="desenho" style="position: relative; z-index: 30; background-color: white; margin-bottom: 20px;"></div>
      <div class="specs-table-container" id="specs-container" style="position: relative; z-index: 10; margin-top: 20px; background-color: white;">
        <!-- A tabela de especifica√ß√µes ser√° renderizada aqui -->
      </div>
    </div>
  </div>

  <!-- Modal de Observa√ß√µes -->
  <div class="modal fade" id="observacoesModal" tabindex="-1" aria-labelledby="observacoesModalLabel">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="observacoesModalLabel">Observa√ß√µes</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <textarea id="observacaoInput" class="form-control" rows="6" placeholder="Observa√ß√µes adicionais sobre o pedido"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Fechar</button>
          <button type="button" class="btn btn-primary" id="btnSalvarObservacoes">Salvar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal de Projetos Salvos -->
  <div class="modal fade" id="projetosModal" tabindex="-1" aria-labelledby="projetosModalLabel">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="projetosModalLabel">
            <i class="bi bi-folder2-open"></i> Projetos Salvos
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <div id="savedConfigs" class="saved-projects-container">
            <!-- Os projetos salvos ser√£o carregados aqui -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- html2canvas para fallback de captura de imagem -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <!-- Carrega o sidebar.js primeiro como script n√£o-modular para disponibilidade global -->
  <script type="module" src="js/sidebar.js"></script>
  
  <!-- Carrega o form-handlers.js diretamente para garantir que nossas modifica√ß√µes s√£o aplicadas -->
  <script type="module" src="js/form-handlers.js"></script>
  
  <!-- Pequeno script para garantir que o sidebar seja inicializado -->
  <script>
    // Garantir que o sidebar seja inicializado quando o DOM estiver pronto
    document.addEventListener('DOMContentLoaded', function() {
      // Atualizar o logo na √°rea de impress√£o
      document.getElementById('print-logo').src = "LOGO 2.png";
      
      setTimeout(function() {
        if (window.sidebarBS && !window.sidebarBS.initialized) {
          console.log('Inicializando sidebar via script inline');
          window.sidebarBS.init();
        }
      }, 200);
    });
  </script>
  
  <!-- Carrega o m√≥dulo principal da aplica√ß√£o -->
  <script type="module" src="js/main.js"></script>

  <!-- Script para garantir a inicializa√ß√£o da valida√ß√£o -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar valida√ß√£o unificada quando o DOM estiver carregado
      setTimeout(function() {
        if (typeof window.configurarValidacao === 'function') {
          window.configurarValidacao();
          console.log('‚úÖ Sistema de valida√ß√£o unificado inicializado');
        } else {
          console.warn('‚ö†Ô∏è Fun√ß√£o de valida√ß√£o unificada n√£o encontrada');
        }
        
        // Adicionar listener diretamente ao campo de altura para definir 2 dobradi√ßas
        const alturaInput = document.getElementById('alturaInput');
        if (alturaInput) {
          alturaInput.addEventListener('change', function() {
            const novaAltura = parseInt(this.value, 10);
            if (!isNaN(novaAltura) && novaAltura >= 300 && novaAltura <= 3000) {
              console.log('Altura alterada para:', novaAltura, 'mm - definindo 2 dobradi√ßas');
              if (typeof window.definirNumeroDobradicas === 'function') {
                window.definirNumeroDobradicas(novaAltura);
              } else {
                console.warn('Fun√ß√£o definirNumeroDobradicas n√£o encontrada');
              }
              
              // Centralizar o puxador vertical quando a altura muda
              if (typeof window.recalcularPosicoesPuxador === 'function') {
                if (typeof window.obterConfiguracaoAtual === 'function') {
                  const configAtual = window.obterConfiguracaoAtual();
                  window.recalcularPosicoesPuxador(configAtual.altura, novaAltura);
                } else {
                  // Se n√£o tiver acesso √† fun√ß√£o de configura√ß√£o, usar a altura antiga como 0
                  window.recalcularPosicoesPuxador(0, novaAltura);
                }
              }
            }
          });
        }
      }, 500); // Pequeno atraso para garantir que todos os scripts estejam carregados
    });
  </script>

  <!-- Bot√£o de diagn√≥stico (escondido, apenas para depura√ß√£o) -->
  <button type="button" id="btnDiagnostico" onclick="window.diagnosticarImpressao()" style="position:fixed; bottom:10px; right:10px; opacity:0.1; font-size:10px;">Diagnosticar</button>
  
  <!-- √Årea de impress√£o dedicada -->
  <div id="print-area" class="print-container">
    <!-- Cabe√ßalho -->
    <div class="print-header">
      <div class="print-header-logo">
        <img src="" id="print-logo" class="print-logo" alt="Logo da empresa">
      </div>
      <div class="print-header-title">
        <h2>Descri√ß√£o da Porta:</h2>
      </div>
    </div>
    
    <!-- Conte√∫do principal -->
    <div class="print-content">
      <div class="watermark">ESPECIFICA√á√ÉO T√âCNICA</div>
      <div id="svg-container-clone" class="svg-container"></div>
    </div>
    
    <!-- Rodap√© -->
    <div class="print-footer">
      <div class="print-disclaimer">
        Este documento √© uma especifica√ß√£o t√©cnica. Todas as medidas devem ser confirmadas antes da fabrica√ß√£o.
      </div>
    </div>
  </div>
  
  <!-- Nova √°rea para impress√£o de m√∫ltiplas p√°ginas com melhor estrutura -->
  <div id="print-booklet" class="print-container">
    <!-- As p√°ginas ser√£o geradas dinamicamente aqui -->
  </div>
  
  <!-- Elemento para impress√£o cl√°ssica (legado) -->
  <div id="impressaoContainer">
    <img id="imagemImpressao" alt="Desenho da Porta" style="display: none;">
  </div>
</body>

</html> 
